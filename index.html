<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz PDF - Verdadero o Falso</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #question-container { margin-top: 20px; display: none; }
        #loading-container { display: none; margin-top: 20px; }
        #progress-bar { width: 100%; height: 20px; background: #ddd; margin-top: 10px; }
        #progress { height: 100%; width: 0%; background: #4caf50; transition: width 0.3s; }
        img { max-width: 100%; height: auto; margin-top: 10px; }
        button { margin: 5px; padding: 10px; cursor: pointer; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
</head>
<body>
    <h1>Sube un PDF con preguntas</h1>
    <input type="file" id="pdfInput" accept="application/pdf">
    
    <div id="loading-container">
        <p>Cargando PDF y extrayendo preguntas...</p>
        <div id="progress-bar"><div id="progress"></div></div>
    </div>
    
    <div id="question-container">
        <p id="question-text"></p>
        <img id="question-image" style="display:none;" alt="Imagen de la pregunta">
        <br>
        <button onclick="checkAnswer(true)">Verdadero</button>
        <button onclick="checkAnswer(false)">Falso</button>
        <p id="feedback"></p>
        <br>
        <button onclick="prevQuestion()">Anterior</button>
        <button onclick="nextQuestion()">Siguiente</button>
    </div>
    
    <script>
        let questions = [];
        let currentIndex = 0;

        document.getElementById('pdfInput').addEventListener('change', async function(event) {
            const file = event.target.files[0];
            if (file) {
                console.log("Archivo seleccionado: " + file.name);
                document.getElementById('loading-container').style.display = 'block';
                document.getElementById('progress').style.width = '0%';
                const reader = new FileReader();
                reader.onload = async function() {
                    console.log("Leyendo archivo PDF...");
                    const typedArray = new Uint8Array(reader.result);
                    const pdf = await pdfjsLib.getDocument(typedArray).promise;
                    console.log("PDF cargado con " + pdf.numPages + " páginas.");
                    let extractedText = "";
                    let images = [];

                    // Procesamos cada página para extraer texto e imágenes
                    for (let i = 1; i <= pdf.numPages; i++) {
                        console.log("Procesando página " + i + "...");
                        document.getElementById('progress').style.width = `${(i / pdf.numPages) * 100}%`;
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        const pageText = textContent.items.map(item => item.str).join(" ");
                        extractedText += pageText + "\n";

                        // Extraer imágenes
                        const pageResources = await page.getOperatorList();
                        const imagesOnPage = extractImages(pageResources);
                        images = images.concat(imagesOnPage);
                    }

                    console.log("Extracción de texto completada.");
                    extractQuestions(extractedText, images);
                    document.getElementById('loading-container').style.display = 'none';
                };
                reader.readAsArrayBuffer(file);
            }
        });

        // Función para extraer imágenes
        function extractImages(pageResources) {
            // Aquí se puede agregar lógica para extraer imágenes de los recursos de la página
            // Esta es una función placeholder. Necesitarás más detalles según las imágenes que estés buscando.
            // Por ahora, solo simula que extrae imágenes vacías.
            return [];  // Esta función debería devolver las imágenes de la página.
        }

        function extractQuestions(text, images) {
            console.log("Extrayendo preguntas del texto...");
            const questionRegex = /([^.?!]*\?)/g;
            const matches = text.match(questionRegex) || [];
            console.log(matches);  // Verifica las preguntas extraídas
            questions = matches.map((q, index) => ({
                text: q.trim(),
                image: images[index] || null,  // Asociamos una imagen si existe
                answer: Math.random() > 0.5
            }));
            console.log("Se encontraron " + questions.length + " preguntas.");
            currentIndex = 0;
            displayQuestion();
        }

        function displayQuestion() {
            if (questions.length === 0) return;
            console.log("Mostrando pregunta " + (currentIndex + 1) + " de " + questions.length);
            document.getElementById('question-container').style.display = 'block';
            document.getElementById('question-text').textContent = questions[currentIndex].text;
            const imgElement = document.getElementById('question-image');
            if (questions[currentIndex].image) {
                imgElement.src = questions[currentIndex].image;  // Asignar la imagen a mostrar
                imgElement.style.display = 'block';
            } else {
                imgElement.style.display = 'none';
            }
            document.getElementById('feedback').textContent = '';
        }

        function checkAnswer(answer) {
            const correct = answer === questions[currentIndex].answer;
            document.getElementById('feedback').textContent = correct ? "Correcto" : "Incorrecto";
            console.log("Respuesta seleccionada: " + (answer ? "Verdadero" : "Falso") + ". Resultado: " + (correct ? "Correcto" : "Incorrecto"));
        }

        function nextQuestion() {
            if (currentIndex < questions.length - 1) {
                currentIndex++;
                displayQuestion();
            }
        }

        function prevQuestion() {
            if (currentIndex > 0) {
                currentIndex--;
                displayQuestion();
            }
        }
    </script>
</body>
</html>
